<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Title</title>
    <link rel="stylesheet" href="assets/layui/css/layui.css"/>
    <link rel="stylesheet" href="assets/css/main.css"/>
</head>
<body class="no-padding">
<!-- header -->
<div class="ew-header">
    <a class="layui-logo" href="index.html">EASY WEB</a>
    <div class="ew-nav-group">
        <div class="nav-toggle"><i class="layui-icon layui-icon-more-vertical"></i></div>
        <ul class="layui-nav" lay-filter="ew-header-nav">
            <li class="layui-nav-item">
                <a lay-href="index.html">首页</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#pricing">授权</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#guide">指南</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#product">产品</a>
            </li>
            <li class="layui-nav-item">
                <a href="doc/" target="_blank">文档</a>
            </li>
            <li class="layui-nav-item">
                <a href="javascript:;">演示<i class="layui-hide-xs">&emsp;</i></a>
                <dl class="layui-nav-child">
                    <dd><a href="https://demo.easyweb.vip/iframe/" target="_blank">iframe版</a></dd>
                    <dd><a href="https://demo.easyweb.vip/spa/" target="_blank">spa单页面版</a></dd>
                    <dd><a href="https://demo.easyweb.vip/pro/" target="_blank">单标签版</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item nav-btn-login"><a href="login.html">登录</a></li>
            <li class="layui-nav-item nav-btn-login"><a href="reg.html">注册</a></li>
        </ul>
    </div>
</div>

<!-- login-wrapper -->
<div class="login-wrapper reg-wrapper">
    <div class="layui-container">
        <form class="layui-form">
            <h2>忘记密码</h2>
            <div class="layui-form-item">
                <label class="layui-form-label">邮箱账号</label>
                <div class="layui-input-block">
                    <input class="layui-input" name="email" type="text" placeholder="请输入邮箱账号"
                           lay-verType="tips" lay-verify="required|email" maxlength="100" required/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">新密码</label>
                <div class="layui-input-block">
                    <input class="layui-input" name="password" type="password" placeholder="请输入新的登录密码"
                           lay-verType="tips" lay-verify="required|psw" maxlength="100" required/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">确认密码</label>
                <div class="layui-input-block">
                    <input class="layui-input" type="password" placeholder="请再次输入新的登录密码"
                           lay-verType="tips" lay-verify="required|repeat" data-target="input[name=password]"
                           data-tips="两次密码输入不一致" required/>
                </div>
            </div>
            <div class="layui-form-item" style="margin-bottom: 18px;">
                <label class="layui-form-label">验证码</label>
                <div class="layui-input-block login-captcha-group">
                    <input class="layui-input" name="code" type="text" placeholder="请输入验证码"
                           autocomplete="off" lay-verType="tips" lay-verify="required" maxlength="20" required/>
                    <button id="btnGetCode" type="button" class="layui-btn">获取验证码</button>
                </div>
            </div>
            <div class="layui-form-item layui-text">
                <div class="layui-input-block text-right" style="min-height: unset;">
                    <a href="login.html">返回登录</a>
                </div>
            </div>
            <div class="layui-form-item" style="margin-bottom: 35px;">
                <div class="layui-input-block">
                    <button class="layui-btn layui-btn-lg layui-btn-fluid" lay-filter="forgetSubmit" lay-submit>
                        修改密码
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- 输入图形验证码弹窗 -->
<script type="text/html" id="layerGetCode">
    <div class="layer-get-code">
        <p>验证码将发送到您的邮箱，输入下方图形验证码点击按钮即可发送：</p>
        <div class="lay-code-group">
            <input maxlength="20" placeholder="请输入图形验证码" class="layui-input"/>
            <img src="https://yun.reg.163.com/urscloud/captcha?type=captcha_pwd&1568683587149&t=' + new Date().getTime() + '"/>
        </div>
        <div>
            <button class="layui-btn layui-btn-fluid">立即发送</button>
        </div>
    </div>
</script>
<!-- js部分 -->
<script type="text/javascript" src="assets/layui/layui.js"></script>
<script type="text/javascript" src="assets/js/common.js"></script>
<script>
    layui.use(['layer', 'form', 'formX'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form;

        // 表单提交
        form.on('submit(forgetSubmit)', function (obj) {
            var loadIndex = layer.msg('请求中...', {icon: 16, shade: 0.01});
            $.post('forget', obj.field, function (res) {
                if (200 == res.code) {
                    layer.msg(res.msg, {icon: 1, time: 1500}, function () {
                        location.href = 'login.html';
                    });
                } else {
                    layer.close(loadIndex);
                    layer.msg(res.msg, {icon: 5});
                }
            }, 'JSON');
            return false;
        });

        // 获取邮箱验证码
        $('#btnGetCode').click(function () {
            var $btn = $(this);
            var $inputEmail = $('input[name="email"]');
            var email = $inputEmail.val();
            /*if (!email) {
                layer.tips('请输入邮箱账号', $inputEmail, {tips: [1, '#ff4c4c']});
                return;
            }
            var emailReg = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/;
            if (!emailReg.test(email)) {
                layer.tips('邮箱格式不正确', $inputEmail, {tips: [1, '#ff4c4c']});
                return;
            }*/
            var layIndex = layer.open({
                type: 1,
                title: false,
                shade: .1,
                skin: 'layui-layer-admin',
                content: $('#layerGetCode').html(),
                success: function () {
                    // 图形验证码点击事件
                    $('.layer-get-code>.lay-code-group>img').click(function () {
                        this.src = this.src + '?t=' + new Date().getTime();
                    });
                    // 立即发送按钮点击事件
                    $('.layer-get-code .layui-btn-fluid').click(function () {
                        var $input = $('.layer-get-code>.lay-code-group>input');
                        var code = $input.val();
                        /*if (!code) {
                            layer.tips('请输入图形验证码', $input, {tips: [3, '#ff4c4c']});
                            return;
                        }*/
                        layer.msg('发送成功，请注意查收', {icon: 1});
                        layer.close(layIndex);
                        startTimer($btn);
                        /* var loadIndex = layer.msg('请求中...', {icon: 16, shade: 0.01, time: false});
                        $.post('sendEmailVer', {
                            code: code,
                            email: email
                        }, function (res) {
                            layer.close(loadIndex);
                            if (res.code == 200) {
                                layer.msg(res.msg, {icon: 1});
                                layer.close(layIndex);
                                startTimer($btn);
                            } else {
                                layer.msg(res.msg, {icon: 2});
                            }
                        }, 'json');*/
                    });
                }
            })
        });

        // 按钮开始倒计时
        function startTimer($btn, second) {
            second || (second = 60);
            $btn.attr('org-text', $btn.text());
            $btn.text(second + 's');
            $btn.attr('disabled', 'disabled');
            $btn.addClass('layui-disabled');
            var timer = setInterval(function () {
                second--;
                if (second <= 0) {
                    clearInterval(timer);
                    $btn.text($btn.attr('org-text'));
                    $btn.removeAttr('disabled');
                    $btn.removeClass('layui-disabled');
                } else {
                    $btn.text(second + 's');
                }
            }, 1000);
        }

    });
</script>
</body>
</html>