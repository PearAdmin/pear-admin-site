<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Title</title>
    <link rel="stylesheet" href="assets/layui/css/layui.css"/>
    <link rel="stylesheet" href="assets/css/main.css"/>
</head>
<body>
<!-- header -->
<div class="ew-header">
    <a class="layui-logo" href="index.html">EASY WEB</a>
    <div class="ew-nav-group">
        <div class="nav-toggle"><i class="layui-icon layui-icon-more-vertical"></i></div>
        <ul class="layui-nav" lay-filter="ew-header-nav">
            <li class="layui-nav-item">
                <a lay-href="index.html">首页</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#pricing">授权</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#guide">指南</a>
            </li>
            <li class="layui-nav-item">
                <a lay-href="index.html#product">产品</a>
            </li>
            <li class="layui-nav-item">
                <a href="doc/" target="_blank">文档</a>
            </li>
            <li class="layui-nav-item no-padding-right">
                <a href="javascript:;">演示<i class="layui-hide-xs">&emsp;</i></a>
                <dl class="layui-nav-child">
                    <dd><a href="https://demo.easyweb.vip/iframe/" target="_blank">iframe版</a></dd>
                    <dd><a href="https://demo.easyweb.vip/spa/" target="_blank">spa单页面版</a></dd>
                    <dd><a href="https://demo.easyweb.vip/pro/" target="_blank">单标签版</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item no-padding-right">
                <a href="javascript:;">管理员<i class="layui-hide-xs">&emsp;</i></a>
                <dl class="layui-nav-child text-center">
                    <dd><a href="info.html">个人中心</a></dd>
                    <dd><a href="order.html">我的订单</a></dd>
                    <dd lay-unselect><a ew-event="psw" data-url="password.html">修改密码</a></dd>
                    <dd lay-unselect><a ew-event="logout" data-url="login.html">退出登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>

<div class="layui-container body-card">
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md3 layui-hide-xs">
            <div class="layui-card">
                <div class="layui-card-body user-info-card">
                    <div class="user-info-top text-center layui-text">
                        <div class="user-info-head">
                            <img src="assets/images/avatar.png"/>
                            <span class="ew-vip-badge">VIP</span>
                        </div>
                        <h2>504836971</h2>
                        <p>这家伙很懒，什么都不说~</p>
                    </div>
                    <div class="user-info-list layui-text">
                        <div class="info-list-item" title="邮箱账号">
                            <i class="layui-icon layui-icon-username"></i>
                            <p>504836971@qq.com</p>
                        </div>
                        <div class="info-list-item" title="用户类型">
                            <i class="layui-icon layui-icon-note"></i>
                            <p>请完善用户类型</p>
                        </div>
                        <div class="info-list-item" title="用户名称">
                            <i class="layui-icon layui-icon-auz"></i>
                            <p>请完善个人信息</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layui-card">
                <div class="layui-card-header">热门产品</div>
                <div class="layui-card-body">
                    <a class="ew-adv-item sm" href="/goods/1">
                        静态版 - 纯静态页面，响应式布局
                    </a>
                    <a class="ew-adv-item sm" href="/goods/2">
                        iframe版 - 支持多标签，功能丰富
                    </a>
                    <a class="ew-adv-item sm" href="/goods/3">
                        spa版 - 支持路由，适合前后端分离
                    </a>
                </div>
            </div>
        </div>
        <div class="layui-col-md9">
            <div class="layui-card">
                <div class="layui-card-body" style="min-height: 600px;box-sizing: border-box;padding-top: 5px;">
                    <div class="layui-tab layui-tab-brief ew-tab">
                        <ul class="layui-tab-title">
                            <li class="layui-this"><a href="order.html">我的订单</a></li>
                            <li class=""><a href="coupon.html">我的优惠券</a></li>
                            <li class=""><a href="info.html">个人信息</a></li>
                        </ul>
                    </div>
                    <div style="margin-top: 10px;">
                        <table id="orderTable" lay-filter="orderTable"></table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- 表格操作列 -->
<script type="text/html" id="tableBar">
    {{# if(d.state==0){ }}
    <a class="layui-btn layui-btn-xs" href="/order/pay/{{d.orderNumber}}" target="_blank">继续支付</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="cancel">取消订单</a>
    {{# }else if(d.state==1){ }}
    <a class="layui-btn layui-btn-sm" lay-event="download">下载代码</a>
    {{# }else if(d.state==2){ }}
    <a class="layui-btn layui-btn-xs" href="/goods/buy/{{d.goodsId}}/{{d.goodsSpecId}}/{{d.goodsValidityId}}">重新购买</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除订单</a>
    {{# }else if(d.state==3){ }}
    <a class="layui-btn layui-btn-sm" href="/goods/{{d.goodsId}}">重新购买</a>
    {{# }else if(d.state==4){ }}
    <a class="layui-btn layui-btn-sm" href="/goods/{{d.goodsId}}">重新购买</a>
    {{# } }}
</script>
<script type="text/html" id="tableBarName">
    <span class="icon-text" lay-event="detail" style="color: #333;cursor: pointer;">
        <i class="layui-icon">&#xe602;</i> {{d.goodsName}}-{{d.goodsSpecName}}
    </span>
</script>

<!-- js部分 -->
<script type="text/javascript" src="assets/layui/layui.js"></script>
<script type="text/javascript" src="assets/js/common.js"></script>
<script>
    layui.use(['layer', 'table', 'util', 'admin'], function () {
        var $ = layui.jquery;
        var layer = layui.layer;
        var table = layui.table;
        var util = layui.util;
        var admin = layui.admin;

        var orderList = JSON.parse('[{"goodsName":"spa单页面版","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":49.9,"totalPrice":49.9,"state":0,"createTime":"2018/12/14 13:52:25","updateTime":"2019/10/02 10:05:20","lastUpdateTime":"2019-10-05","version":"v3.1.5"},{"goodsName":"spa单页版Java后端","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":0.0,"totalPrice":0.0,"state":0,"createTime":"2018/12/14 13:52:25","updateTime":"2019/10/02 10:05:20","lastUpdateTime":"2019-10-12","version":"v1.3.4"},{"goodsName":"iframe多标签版","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":49.9,"totalPrice":49.9,"state":0,"createTime":"2018/10/16 08:54:31","updateTime":"2019/10/02 10:05:24","lastUpdateTime":"2019-10-05","version":"v3.1.5"},{"goodsName":"iframe版Java后端","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":0.0,"totalPrice":0.0,"state":2,"createTime":"2018/10/16 08:54:31","updateTime":"2019/10/02 10:05:24","lastUpdateTime":"2019-10-07","version":"v3.1.5"},{"goodsName":"静态单标签版","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":49.9,"totalPrice":49.9,"state":1,"createTime":"2019/02/23 11:49:54","updateTime":"2019/10/02 10:05:31","lastUpdateTime":"2019-10-05","version":"v3.1.5"},{"goodsName":"单标签版Java后端","goodsSpecName":"源码版","goodsValidityName":"永久","expirationTime":null,"payPrice":29.9,"totalPrice":29.9,"state":1,"createTime":"2019/02/23 11:49:54","updateTime":"2019/10/02 10:05:31","lastUpdateTime":"2019-10-08","version":"v3.1.5"}]');

        // 渲染表格
        var insTb = table.render({
            elem: '#orderTable',
            // url: 'assets/orderList.json',
            data: orderList,
            page: true,
            cellMinWidth: 100,
            cols: [[
                {type: 'numbers'},
                {toolbar: '#tableBarName', title: '授权产品', minWidth: 120},
                {field: 'goodsValidityName', align: 'center', title: '授权时长', minWidth: 90, width: 90},
                {
                    templet: function (d) {
                        return '<span style="color: #ff6700;">￥' + d.payPrice + '</span>';
                    }, align: 'center', title: '付款金额', minWidth: 90, width: 90
                },
                {
                    templet: function (d) {
                        return '<span class="icon-text" lay-tips="更新于' + d.lastUpdateTime + '">' + d.version + ' <i class="layui-icon layui-icon-tips"></i></span>';
                    }, align: 'center', title: '当前版本', minWidth: 90, width: 90
                },
                {
                    templet: function (d) {
                        var strs = [
                            '<span class="text-warning">待支付</span>',
                            '<span class="text-success">已完成</span>',
                            '<span class="text-danger">已取消</span>',
                            '<span class="text-muted">已退款</span>',
                            '<span class="text-muted">已过期</span>'
                        ];
                        return strs[d.state];
                    }, align: 'center', title: '状态', minWidth: 75, width: 75
                },
                {align: 'center', toolbar: '#tableBar', title: '操作', minWidth: 160, width: 160}
            ]],
            size: 'lg'
        });

        // 工具条点击事件
        table.on('tool(orderTable)', function (obj) {
            var data = obj.data;
            var layEvent = obj.event;
            if (layEvent == 'cancel') { // 取消
                layer.confirm('确定要取消此订单吗？', {
                    skin: 'layui-layer-admin',
                    shade: .1
                }, function (i) {
                    layer.close(i);
                    var loadIndex = layer.msg('请求中...', {icon: 16, shade: 0.01});
                    $.post('order/cancel', {
                        orderId: data.orderId
                    }, function (res) {
                        layer.close(loadIndex);
                        if (res.code == 200) {
                            layer.msg(res.msg, {icon: 1});
                            insTb.reload();
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    }, 'json');
                });
            } else if (layEvent == 'del') { // 删除
                layer.confirm('确定要删除此订单吗？', {
                    skin: 'layui-layer-admin',
                    shade: .1
                }, function (i) {
                    layer.close(i);
                    var loadIndex = layer.msg('请求中...', {icon: 16, shade: 0.01});
                    $.post('order/delete', {
                        orderId: data.orderId
                    }, function (res) {
                        layer.close(loadIndex);
                        if (res.code == 200) {
                            layer.msg(res.msg, {icon: 1});
                            insTb.reload();
                        } else {
                            layer.msg(res.msg, {icon: 2});
                        }
                    }, 'json');
                });
            } else if (layEvent == 'download') {  // 下载
                // window.open('/order/download/' + data.orderId);
            } else if (layEvent == 'detail') {  // 详情
                var strs = [
                    '<span class="text-warning">待支付</span>',
                    '<span class="text-success">已完成</span>',
                    '<span class="text-danger">已取消</span>',
                    '<span class="text-muted">已退款</span>',
                    '<span class="text-muted">已过期</span>'
                ];
                var htmlStr = '<div style="padding: 10px;"><table class="layui-table order-info-tb" style="margin: 0;" lay-size="lg">';
                htmlStr += '      <tbody>';
                htmlStr += '         <tr>';
                htmlStr += '            <th>商品名称：</th>';
                htmlStr += '            <td colspan="3">' + data.goodsName + '</td>';
                htmlStr += '         </tr>';
                htmlStr += '         <tr>';
                htmlStr += '            <th>商品规格：</th>';
                htmlStr += '            <td>' + data.goodsSpecName + '</td>';
                htmlStr += '            <th>授权时长：</th>';
                htmlStr += '            <td>' + data.goodsValidityName + '</td>';
                htmlStr += '         </tr>';
                htmlStr += '         <tr>';
                htmlStr += '            <th>付款金额：</th>';
                htmlStr += '            <td><span style="color: #ff6700;">￥' + data.payPrice + '</span></td>';
                htmlStr += '            <th>到期时间：</th>';
                htmlStr += '            <td>' + (data.expirationTime ? util.toDateString(data.expirationTime, 'yyyy-MM-dd HH:mm') : '永久') + '</td>';
                htmlStr += '         </tr>';
                htmlStr += '         <tr>';
                htmlStr += '            <th>当前版本：</th>';
                htmlStr += '            <td colspan="3">' + data.version + '  更新于' + data.lastUpdateTime + '</td>';
                htmlStr += '         </tr>';
                htmlStr += '         <tr>';
                htmlStr += '            <th>购买时间：</th>';
                htmlStr += '            <td colspan="2">' + util.toDateString(data.createTime, 'yyyy-MM-dd HH:mm') + '</td>';
                htmlStr += '            <td>状态：' + strs[data.state] + '</td>';
                htmlStr += '         </tr>';
                htmlStr += '      </tbody>';
                htmlStr += '   </table></div>';
                var $a = $(obj.tr).find('[lay-event="detail"]');
                var offset = $a.offset();
                var top = offset.top - $(document).scrollTop();
                var left = offset.left;
                layer.open({
                    type: 1,
                    title: false,
                    skin: 'layui-layer-admin ew-layer-tb-drop',
                    area: '500px',
                    shade: .01,
                    fixed: false,
                    shadeClose: true,
                    offset: [(top + $a.outerHeight()) + 'px', left + 'px'],
                    content: htmlStr
                });
            }
        });

        // 小屏幕位置调整
        if (admin.getPageWidth() <= 768) {
            $('.layui-card-body').css('min-height', 'unset');
        }

    });
</script>
</body>
</html>